<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Typist</title>
     <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .myCanvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <div id="capture" style="padding: 10px; background: #f5da55; width: 640px; height: 360px;">
        <h4 id="text" style="color: #000;"></h4>
    </div>
    
    <canvas id="screen" width="640" height="360" style="padding: 10px; background: #f5da55; width: 640px; height: 360px;"></canvas>

    <script>
        let fullstr = "Hello world you fox jumped over the naked fence";
        let counter = 0;
        let normtime = 75;


        updateString = () => {
            counter++;
            if (counter > fullstr.length)
                return false;

            let text = fullstr.substring(0, counter);
            document.getElementById('text').innerHTML = text;

            
            html2canvas(document.querySelector("#capture"), {
                width: 320,
                height: 180,
                useCORS: true,
                allowTaint: true,
                backgroundColor: null,
                canvas: document.getElementById('screen'),
                scale: 1
            });

            return true;
        }

        repeat = () => {
            if ( !updateString() ) {
                setTimeout(stopRecording, 3000);
                return false;
            }

            let delay = Math.abs(normtime * (Math.cos(counter)) + (normtime * Math.random()));
            setTimeout(repeat, delay);
        }




        // Recorder

        const mimetype = 'video/webm';
        const fileextension = ".webm";
        const canvas = document.getElementById('screen');
        const stream = canvas.captureStream(30); // 30 FPS

        let chunks = [];
        const recorder = new MediaRecorder(stream, { mimeType: mimetype });

        recorder.ondataavailable = (e) => {
            chunks.push(e.data);
        };

        recorder.onstop = () => {
            const blob = new Blob(chunks, { type: mimetype });
            const videoURL = URL.createObjectURL(blob);

            // You can download the video or embed it in the page
            const downloadLink = document.createElement('a');
            downloadLink.href = videoURL;
            downloadLink.download = 'animation' + fileextension;
            downloadLink.click();
        };

        // Function to end recording after a specific time or event
        function stopRecording() {
            recorder.stop();
        }



        recorder.start();
        setTimeout(repeat, 500);
        
    </script>
</body>
</html>
